---
import Layout from "@/layouts/Layout.astro";
import { design, electric, hydro, structural, voz, approval, visit } from "@/config";

const prices = {
  levantamiento: 0,
  disenoArq: design,
  planosElec: electric,
  planosHidro: hydro,
  planosEstr: structural,
  planosVoz: voz,
  aprobacion: approval,
  visita: visit,
};
---

<Layout
  title="Cotizador - ACIMU"
  description="Cotiza tu proyecto arquitectónico con nosotros. Obtén un estimado rápido y personalizado."
>
  <main class="container">
    <section class="quote-intro">
      <h1>Cotizador de Proyectos</h1>
      <p>
        Calcula un estimado para tu proyecto. Selecciona los servicios que
        necesitas e ingresa el área de construcción.
      </p>
    </section>

    <section class="quote-form-container">
      <form id="quote-form" class="quote-form">
        <!-- Tipo de Proyecto -->
        <div class="form-group">
          <label for="projectType">Tipo de Proyecto</label>
          <div class="select-wrapper">
            <select id="projectType" name="projectType" required>
              <option value="" disabled selected>Selecciona una opción</option>
              <option value="residencial">Residencial</option>
              <option value="comercial">Comercial</option>
              <option value="habitacional">Habitacional</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>

        <!-- Ciudad -->
        <div class="form-group">
          <label for="city">Ciudad</label>
          <input
            type="text"
            id="city"
            name="city"
            placeholder="Ej. Quito"
            required
          />
        </div>

        <!-- Área -->
        <div class="form-group">
          <label for="area">Área aproximada (m²)</label>
          <input
            type="number"
            id="area"
            name="area"
            min="1"
            placeholder="0"
            required
          />
        </div>

        <!-- Servicios -->
        <div class="form-group">
          <label class="services-label">Servicios Requeridos</label>
          <div class="checkbox-grid">
            <label class="checkbox-item">
              <input
                type="checkbox"
                name="service"
                value="levantamiento"
                data-price={prices.levantamiento}
              />
              <span>Levantamiento</span>
            </label>

            <label class="checkbox-item">
              <input
                type="checkbox"
                name="service"
                value="disenoArq"
                data-price={prices.disenoArq}
              />
              <span>Diseño Arquitectónico</span>
            </label>

            <label class="checkbox-item">
              <input
                type="checkbox"
                name="service"
                value="planosElec"
                data-price={prices.planosElec}
              />
              <span>Planos Eléctricos</span>
            </label>

            <label class="checkbox-item">
              <input
                type="checkbox"
                name="service"
                value="planosHidro"
                data-price={prices.planosHidro}
              />
              <span>Planos Hidrosanitarios</span>
            </label>

            <label class="checkbox-item">
              <input
                type="checkbox"
                name="service"
                value="planosEstr"
                data-price={prices.planosEstr}
              />
              <span>Planos Estructurales</span>
            </label>

            <label class="checkbox-item">
              <input
                type="checkbox"
                name="service"
                value="planosVoz"
                data-price={prices.planosVoz}
              />
              <span>Planos Voz y Datos</span>
            </label>

            <label class="checkbox-item">
              <input
                type="checkbox"
                name="service"
                value="aprobacion"
                data-price={prices.aprobacion}
              />
              <span>Aprobación de Planos</span>
            </label>

            <label class="checkbox-item">
              <input
                type="checkbox"
                name="service"
                value="visita"
                data-price={prices.visita}
              />
              <span>Visita Técnica</span>
            </label>
          </div>
        </div>

        <!-- Total -->
        <div class="total-section">
          <h2>Estimado Total</h2>
          <div class="total-amount" id="totalAmount">$0.00</div>
          <p class="disclaimer">
            * Este valor es un estimado y está sujeto a validación. Nos adaptamos
            a tus necesidades y presupuesto.
          </p>
        </div>

        <div class="actions">
          <a href="/contact" class="btn-secondary">
            ¿Está fuera de tu presupuesto? Contáctanos
          </a>
        </div>
      </form>
    </section>
  </main>
</Layout>

<script>
  const form = document.getElementById('quote-form') as HTMLFormElement;
  const areaInput = document.getElementById('area') as HTMLInputElement;
  const checkboxes = document.querySelectorAll(
    'input[name="service"]'
  ) as NodeListOf<HTMLInputElement>;
  const totalDisplay = document.getElementById('totalAmount');

  function calculateTotal() {
    let area = parseFloat(areaInput.value) || 0;
    let ratePerM2 = 0;
    let fixedCost = 0;

    checkboxes.forEach((checkbox) => {
      if (checkbox.checked) {
        const price = parseFloat(checkbox.dataset.price || '0');
        if (checkbox.value === 'visita') {
          fixedCost += price;
        } else {
          ratePerM2 += price;
        }
      }
    });

    const total = ratePerM2 * area + fixedCost;

    if (totalDisplay) {
      totalDisplay.textContent = total.toLocaleString('en-US', {
        style: 'currency',
        currency: 'USD',
      });
    }
  }

  form.addEventListener('input', calculateTotal);

  areaInput.addEventListener('input', () => {
    if (parseFloat(areaInput.value) < 1) {
      areaInput.value = '1';
    }
  });
</script>

<style>
  .container {
    margin-top: 5rem;
    padding-bottom: var(--spacing-xl);
  }

  .quote-intro {
    text-align: center;
    padding: var(--spacing-xl) 0;
    max-width: 800px;
    margin: 0 auto;
  }

  h1 {
    font-size: 3rem;
    margin-bottom: var(--spacing-md);
  }

  .quote-form-container {
    max-width: 800px;
    margin: 0 auto;
    background-color: var(--color-background-alt);
    padding: var(--spacing-xl);
    border-radius: var(--border-radius);
    border: 1px solid var(--color-muted);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  }

  .form-group {
    margin-bottom: var(--spacing-lg);
  }

  label {
    display: block;
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
    font-family: var(--font-serif);
  }

  input[type='text'],
  input[type='number'],
  select {
    width: 100%;
    padding: var(--spacing-md);
    border-radius: var(--border-radius);
    border: 1px solid var(--color-muted);
    background-color: var(--color-background);
    color: var(--color-text);
    font-family: var(--font-sans);
    font-size: 1rem;
    box-sizing: border-box; /* Ensure padding doesn't affect width */
  }

  input:focus,
  select:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 2px rgba(77, 66, 41, 0.1);
  }

  .checkbox-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: var(--spacing-md);
  }

  .checkbox-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    cursor: pointer;
    font-weight: normal;
    padding: var(--spacing-sm);
    border-radius: var(--border-radius);
    transition: background-color 0.2s;
  }

  .checkbox-item:hover {
    background-color: var(--color-background);
  }

  input[type='checkbox'] {
    width: 20px;
    height: 20px;
    accent-color: var(--color-primary);
  }

  .total-section {
    text-align: center;
    margin-top: var(--spacing-xl);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-muted);
  }

  .total-amount {
    font-size: 3rem;
    font-weight: 700;
    color: var(--color-primary);
    margin: var(--spacing-sm) 0;
    font-family: var(--font-serif);
  }

  .disclaimer {
    font-size: 0.9rem;
    color: var(--color-text-light);
    font-style: italic;
  }

  .actions {
    margin-top: var(--spacing-lg);
    text-align: center;
  }

  .btn-secondary {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-xl);
    border: 2px solid var(--color-primary);
    color: var(--color-primary);
    border-radius: 999px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-secondary:hover {
    background-color: var(--color-primary);
    color: white;
  }

  @media (max-width: 768px) {
    .quote-form-container {
      padding: var(--spacing-lg);
    }
    
    .checkbox-grid {
      grid-template-columns: 1fr;
    }

    h1 {
      font-size: 2rem;
    }

    .total-amount {
      font-size: 2.5rem;
    }
  }
</style>

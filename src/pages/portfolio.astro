---
export const prerender = true;
import Layout from '@/layouts/Layout.astro';
import ProjectCard from '@/components/projectCard.astro';
import InfiniteCarousel from '@/components/InfiniteCarousel.astro';
import projects from '@/data/projects.js';
import renders from '@/data/projectsCollage.js';
---

<Layout
  title="Portfolio - ACIMU"
  description="Explore our portfolio of residential, commercial, and public projects."
>
  <main class="container">
    <section class="portfolio-intro">
      <h1>Portafolio</h1>
    </section>

    <section class="carousel">
      <InfiniteCarousel images={renders} direction="left" enableModal={false} />
      <InfiniteCarousel
        images={renders}
        direction="right"
        enableModal={false}
      />
    </section>
    <section class="portfolio-container">
      {
        projects.map((project) => (
          <div class="item">
            <ProjectCard
              title={project.title}
              description={project.description}
              imageUrl={project.imageUrl}
              url={project.url}
            />
          </div>
        ))
      }
    </section>
  </main>
</Layout>

<style>
  .carousel {
    height: 70vh;
    width: 100vw;
    margin-left: calc(50% - 50vw);
  }
  .portfolio-intro {
    text-align: center;
    padding: var(--spacing-xl) 0;
    margin-top: 5rem;
  }
  h1 {
    font-size: 3.5rem;
  }
  .portfolio-container {
    position: relative;
  }
  .item {
    height: 70vh;
    position: sticky;
    top: 10vh;
    overflow: hidden;
    margin-bottom: 10vh;
  }
  .item:last-child {
    margin-bottom: 0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const items = Array.from(
      document.querySelectorAll('.item')
    ) as HTMLElement[];
    if (items.length < 2) return;

    const onScroll = () => {
      const vh = window.innerHeight;
      const tenVh = vh * 0.1;

      items.forEach((item, i) => {
        if (i === items.length - 1) return;

        const nextItem = items[i + 1];
        const nextItemRect = nextItem.getBoundingClientRect();
        const nextItemTop = nextItemRect.top;

        const startScaling = vh;
        const endScaling = tenVh;

        if (nextItemTop < startScaling && nextItemTop > endScaling) {
          const progress =
            (startScaling - nextItemTop) / (startScaling - endScaling);
          const scale = 1 - progress * 0.2;
          item.style.transform = `scale(${Math.max(0.8, scale)})`;
        } else if (nextItemTop <= endScaling) {
          item.style.transform = 'scale(0.8)';
        } else {
          item.style.transform = 'scale(1)';
        }
      });
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  });
</script>
